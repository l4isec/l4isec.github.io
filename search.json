[{"title":"Dumpeo de Credenciales","url":"/2023/01/07/Dumpeo-de-Credenciales/","content":"Dumpeo de CredencialesHashes NTLMsekurlsa::logonpassword es famoso por dumpear las contraseñas en texto claro de la memoria. Con los hashes NTLM podemos realizar un Pass The Hash  o simplemente podemos crackear y conseguir una contraseña en texto claro.\nmimikatz.exe sekurlsa::logonpasswords\n\n\nKerberos Encription Keyssekurlsa::ekeys nos permite poder dumpear las keys de encription de kerberos de todo los usuarios que estan actualmente logueados. \nmimikatz.exe sekurlsa::ekeys\n\nEn este caso el hash AES256 es la que tenemos que guardar.\nSecurity Account ManagerO mejor conocido como la SAM es una base de datos donde va estar alojado todos los hashes NTLM de las cuentas locales podemos dumpearlo con lsadump::sam.\nmimikatz.exe lsadump::sam\n\nDomain Cached CredentialsO mejor también conocidas como DCC, son hashes NTLM que no se pueden usar como para el Pass The Hash, la única forma de aprovechar esto es crackearlo en offline. lsadump::cache , también puede ser extraidos del HKLM\\SECURITY\nmimikatz.exe lsadump::cache\n\nExtraer Kerberos TicketsPodemos ultilizar Rubeus para llevar acabo esto, con el comando triage esto requiere de unos privilegios altos, lo que hace este comando es listar todo los tickets en la sesión que estamos logueada.\nrubeus.exe triage\n\nEl output de esto nos lo va mostrar como algo así \n\n\n\nLUID\nUserName\nService\nEndTime\n\n\n\n0x7049f\njking @ web.NCORP.IO\nkrbtgt&#x2F;dev.NCORP.IO\n9&#x2F;1&#x2F;2022 5:29:20 PM\n\n\nUna vez que tengamos listado los tickets en este caso nos interesa el de jking, podemos extraerlo con dump lo que nos va extraer es el TGT.\nrubeus.exe dump /luid:0x7049f /service:krbtgt /nowrap\n\nDCSyncEl DCSync se aprovecha del protocolo Directory Replication Service para extraer usernames y credenciales del DC.\nEsto requiere de unos privilegios de GetNCChanges que acutalmente solo estará disponible para los Domain Admins.\n\n\nPara hacer dcsync podemos usar directamente el comando que viene en el Cobalt Strike o lsadump::dcsync.\nmimikatz.exe lsadump::dcsync /domain:dev.ncorp.io /user:DEV\\Krbtgt\n\n","categories":["Tools"],"tags":["Active Directory","Red Team"]},{"title":"Certified Red Team Operator (CRTO) Review","url":"/2023/01/07/CRTO-Review/","content":"OverviewRecientemente tuve la oportunidad de cursar y examinarme del curso de ZeroPoint Security Red Team Ops. Curso hecho y impartido por Daniel Duggan aka Rastamouse y aquí os dejo mi review sobre el curso y el examen.\nMi BackgroundMi background en este terreno de IT podemos decir que soy un novato. Sigo aun en primero de carrera, empecé en la ciberseguridad ofensiva hace menos de 1 año, y respecto a otras certificaciones que tengo de momento es la del CRTP (Certified Red Team Professional) tenéis mi review aquí. \n\nCursoComo pueden ver en el nombre de esta certificación el curso va estar solamente enfocada entorno al tema de red teaming respecto al material del curso yo diría el material que nos ofrece ZeroPoint Security es de una calidad TOP.  Donde vas a tener la oportunidad de poder pilotar de unos de los C2 más conocido e moderno de hoy en día el grandísimo  Cobalt Strike . En este curso te viene incluido un LAB de 40 horas si decides comprar el pack de 399 pounds (entorno a  473 euros), al principio pensé que los 40 horas de lab iban a ser muy pocas, pero finalmente pude terminar el  lab del curso con 20 horas,  el resto de horas del laboratotio lo usé para testear métodos, ya que el curso es muy extenso donde estarás aprendiendo sobre:\n\nCommand &amp; Control\nExternal Recon\nInitial Compromise\nHost Recon\nHost Persistence\nHost Privilege Escalation\nElevate Host Persistence\nCredentials Dumping\nDomain Recon\nUser Impersonation\nLateral Movement\nSession Passing\nPivoting\nData Protection API\nKerberos\nAD CS\nGroup Policy\nMS SQL\nDomain Persistence\nForest &amp; Domain Trusts\nLocal Administrator Password Solution\nMicrosoft Defender AV\nApplication Whitelisting\nData Hunting &amp; Exiltration\n\nComo podréis ver es un curso muy extenso donde hacerte un rush del contenido puede ser un poco arriesgado de cara al examen. La metología que apliqué para no abrumarme de conceptos, fue primero mirarme el curso entero y tomar apuntes de primera vista luego más tarde fui por cada módulo y tomar apuntes más detallada e investigar mas a fondo sobre los conceptos, finalmente me lanzé al lab con los apuntes tomados previamente, esto me tomó alrededor de 1 mes y medio. Respecto a la opinión del curso me gustó bastante los módulos de Kerberos donde te explica desde 0 el funcionanmiento del Kerberos y también el módulo de Inital Comprise donde puedes aprender a hacer phishing para ganar acceso al dominio junto con la evasión del Windows Defender.\n\nExamenSobre el examen de la CRTO es de estilo CTF donde tienes en total 8 flags para recolectar en el laboratorio del examen y con el 75% de flags (6&#x2F;8) para aprobar y con 48 horas de examen en el cual puedes repartirlos entre 4 días. Con la prevía experiencia de haber examinado la CRTP en esta certificación a la hora del examen pude estar mas relajado, el examen que me tocó fue de simular un APT contra X objetivos con X dominios que no puedo especificar en la review. \nTerminé el curso el día 29&#x2F;12&#x2F;2022 y decidí examinarme el día siguiente 30&#x2F;12&#x2F;2022 sé que era una locura ya que esto significaba pasar el año nuevo haciendo un examen, pero yo ya me quería quitarme el peso de encima y puse el examen el día siguiente a las 12:00 AM . La noche anterior estuve mirando review por internet y la verdad podriamos decir que me intimidó demasiado el examen, donde había gente que no podía levantar los beacons o el Windows Defender detectaba y mataba el procesos al instante gastandose las primeras 10 horas del examen o el primer día solucionando estos problemas, pero por sorpresa en mi caso tardé 8 horas en total del examen para conseguir las 6&#x2F;8 flags suficientes para aprobar hoy es mi segundo día del examen y seguramente después de escribir esta review vuelva a enceder el laboratorio del examen y intentar conseguir las 2 flags restantes.\n\n\n\n\nRespecto a la dificultad del examen para mí la verdad no ha sido demasiado difícil ya que venia con conocimientos previos de como “atacar” un Active Directory, no quiero decir que sea un examen regalado ya que en ciertos puntos vas a tener que think outside of the box para combinar métodos de ataque para comprometer una máquina del dominio o de otra forest. La dificultad en general de la certificaciones en mi opinión puede ser una certificación media&#x2F;alta (puede cambiar con el paso del tiempo).\n\n\n\nConclusiónSi estás buscando una certificación en el que puedas aprender sobre temas de red teaming y el  manejo de un C2 esta certificación diría yo que es la mejor y la perfecta para la gente que se esté iniciando en este campo cabe destacar que ZeroPoint Security sacó hace poco una acontinuación CRTL que es más avanzada entrando en temas de evasión de EDR y AV, pero bueno aun me queda un largo camino llegar hasta ahí. Esta ha sido mi review sobre esta certificación si tenéis alguna duda siempre podéis  encontrarme en Twitter o Linkedin para hablarme :D un saludo y hasta la próxima. \n\n\nRecuros interesantes\nhttps://medium.com/r3d-buck3t/attacking-kerberos-constrained-delegations-4a0eddc5bb13#f061\nhttps://hausec.com/2021/07/26/cobalt-strike-and-tradecraft/\nhttps://www.redteam101.tech/\nhttps://www.ired.team/offensive-security/red-team-infrastructure/cobalt-strike-101-installation-and-interesting-commands?q=COBALTSTRIKE\n\n","categories":["Certificación"],"tags":["Review","Active Directory","Red Team"]},{"title":"Certified Red Team Professional (CRTP) Review","url":"/2023/01/07/CRTP-Review/","content":"Certified Red Team Professional (CRTP) Review EspañolHola a todos hoy voy a escribir mi propia review sobre el Bootcamp de la certificación CRTP en esta review estará dividida en partes que son:\n\nBootcamp\nContenido\nExamen    \nRecomendación personal    \nConclusión\n\n\nFuturos Objetivos\n\n\nBootcampBueno, al principio no tenía pensado apuntarme al bootcamp de la CRTP, sino que comprar el curso en sí, pero hablándolo con un amigo decidí ir a por el Bootcamp en el cual son total de 4 sesiones todas de ellas siempre se hacen los domingos y cada sesión suele durar como mínimo 3 horas en el cual se dará material del curo y la gran diferencia del bootcamp con el curso normal es que son sesiones en vivo, con esto me refiero que puedes preguntarle al profesor, en mi caso fue Nikhil también con el bootcamp vendrá con un servidor en Discord donde podéis relacacionaros con todo los estudiantes. La verdad del bootcamp no tengo nada que añadir. Para apuntarse aqui os dejo el link.\n\nContenidoRespecto al contenido del curso yo creo que esta bastante completo, ya que te enseñan desde 0 como enumerar manualmente con PowerView aunque también en el curso te enseñan como usar el buen BloodHound herramienta cuál me dio muchos problemas en el examen y tuve que enuemrar todo manualmente. Además de esto te enseñan  Local Privilege Escalation, aquí debo decir que las técnicas que se cubren en el curso son pocas, después de esto seguirás con Lateral Movement, Percistencia, Domain Privilege Escalation y Cross Trust Attacks. Además de esto en el bootcamp te enseñan más conceptos resumiendolo sería este:\n\nActive Directory Enumeration\nLocal Privilege Escalation    \nDomain Privilege Escalation \nDomain Persistence and Dominance \nCross Trust Attacks+ Forest Persistence and Dominance\nDefenses – Monitoring\nDefenses and bypass – Architecture and Work Culture Changes + Defenses and Bypass – Deception\nDefenses and Bypass – PowerShell\n\nVolviendo al tema del curso también te viene incluido en el bootcamp un lab de duración 1 mes el cual podéis prologarlo más tarde si queréis practicar más podéis ver la estructura del lab en este link, además de esto en el bootcamp se te dará un link donde está toda la materia (tools,manuales,pdf,videos). \n\n\n\nExamenDespués del curso viene lo más interesante que es la examinación de la certificación donde se pondrá a prueba todos los conceptos aprendidos en el curso consiste un examen de 24 horas donde tienes que comprometer los 5 usuarios incluidos la local y Enterprise Admin más la elaboración de un reporte el cual tienes como máximo 48 horas para enviar. Mi examen fue el día 6&#x2F;10&#x2F;2022 antes de empezarlo me hice una plantilla en Word para el reporte, también como es la primera certificación que hago y si es la vuestra también es normal que tengáis nervios antes y incluso en el examen, lo que pasó conmigo, pero he de decir que los nervios no siempre son malos, ya que te hacen que te enfoques más en el examen. Volviendo al examen yo lo empecé entre el mañana y el medio día, algo que no recomiendo es empezarlo por la noche si no sois muy nocturnos aunque siempre está la frase de ‘Los hackers nunca duermen ;)’. No puedo entrar mucho en detalle sobre el laboratorio que me cayó en el examen, pero la verdad es que si hicistes todo durante el curso el examen no te resoltará un gran problema ojo aquí no refiero que sea un paseo el examen, a diferencia del lab de practica aquí tienes que comprometer el primer usuario para poder moverte al siguiente, el cual me costó el más en el examen. En total gasté alrededor de unas 17-18 horas para comprometer el AD completo del examen y en el reporte unas 2 horas en total.\nRecomendación PersonalLo esencial de cara al examen es el control de los nervios, ya que ami me ocurrió un efecto en el que me concentraba tanto que al principio me dejaba muchas cosas en la enumeración de cositas muy simples. Otra recomendación es la programación de breaks, es decir descansitos pequeños donde salgas a la terraza o a la calle para airearte un poco cosa que yo no hice y después pasan cosas que dan para anécdotas muy divertidas :), es también muy esencial hacerte una cheatsheet propia para el examen además de estar tomando nota durante el curso en mi caso use Obsidian como note taker. \nConclusionesEn conclusión  creo que es un curso y una certificación bastante buena de cara para aprender el AD desde 0 y también muy buena para reforzar el concepto de Active Directory si tenéis pensada examinarte de OSCP, ya que ahora es esencial la parte del AD en el examen.\n","categories":["Certificación"],"tags":["Review","Active Directory","Red Team"]}]